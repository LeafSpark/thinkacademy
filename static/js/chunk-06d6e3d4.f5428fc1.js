(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-06d6e3d4"],{"00d9":function(t,e,i){"use strict";i("506e")},"0219":function(t,e,i){},"0481":function(t,e,i){"use strict";var n=i("23e7"),o=i("a2bf"),s=i("7b0b"),r=i("07fa"),a=i("5926"),c=i("65f0");n({target:"Array",proto:!0},{flat:function(){var t=arguments.length?arguments[0]:void 0,e=s(this),i=r(e),n=c(e,0);return n.length=o(n,e,e,i,0,void 0===t?1:a(t)),n}})},"0ccb":function(t,e,i){"use strict";var n=i("e330"),o=i("50c4"),s=i("577e"),r=i("1148"),a=i("1d80"),c=n(r),f=n("".slice),l=Math.ceil,u=function(t){return function(e,i,n){var r,u,d=s(a(e)),h=o(i),g=d.length,m=void 0===n?" ":s(n);return h<=g||""===m?d:(r=h-g,u=c(m,l(r/m.length)),u.length>r&&(u=f(u,0,r)),t?d+u:u+d)}};t.exports={start:u(!1),end:u(!0)}},4069:function(t,e,i){"use strict";var n=i("44d2");n("flat")},"4d90":function(t,e,i){"use strict";var n=i("23e7"),o=i("0ccb").start,s=i("9a0c");n({target:"String",proto:!0,forced:s},{padStart:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}})},"506e":function(t,e,i){},"5f7f":function(t,e,i){},"85e5":function(t,e){t.exports="data:image/png;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBwgICAcIBwcHBwcHBw0HBwcHBw8ICQcNFREWFhURExMYHSggGCYxGxMTITEhJSkrLi4uFx8zODMsNygtLisBCgoKDQ0NDw8PDysZFRkrKystKys3LSsrNys3KysrKysrLSstKystKy0rKysrKysrKysrKysrKysrKysrKysrK//AABEIAMIBAwMBIgACEQEDEQH/xAAWAAEBAQAAAAAAAAAAAAAAAAAAAQf/xAAXEAEBAQEAAAAAAAAAAAAAAAAAARFR/8QAFgEBAQEAAAAAAAAAAAAAAAAAAAEC/8QAFBEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEQMRAD8Aw4gCAIqqAgAKIAgKgACqICggACiAoICgIAAgAAAAAAAoAICKUUAUAQABAAUAVBAFAAAAAABUUBBQAEQAAAAAURQQQUVRFRBQQAAAAAAABQAAAAVAFRUQVFFACIgAAAAAAAAEAEVBQAAAAAAAABQAQAAAAAAUQBQAABAAAADABQAQQBQAAAAAAAAAAAAAABQABQEAAAAQAAAAAAAFQBQAQAAAAAAAAAAAFAAAAFBEF0BQARAAAAAAAAEAFAAAAAAAAAAAAAFAAAWgIoiCggKAIAACgIAAAKgqAKiggAAAAAAAACgAAAgoigigAAIAAAAAACKKAAICgAgAKACAAAAAAoAAKgCiCCgAACAAAAAAAAoAIigqiKIIAoCiCAKAqIAoCAtURQARRAAEAAAAAAAAAAAAAAAAANFKagAogCoqgioCwCIIKAACAAAAAAAAAIqqAiAAAAAACKCopQAwAABBFAAAAAAAAAAAAAAAAAVAAAAICqAIgABQBRABUAFAEIAAAAAoAIHQAFQAAAAaV//Z"},9093:function(t,e,i){},9973:function(t,e,i){"use strict";i.r(e),i.d(e,"default",(function(){return ft}));var n=i("5530"),o=i("d4ec"),s=i("bee2"),r=i("262e"),a=i("2caf"),c=i("b6c9"),f=function(){var t=this,e=t._self._c;return t.isSubmit?t._e():e("div",{staticClass:"graffitiContainer",attrs:{id:"graffitiContainer"}},[t.isNewGraffiti?e("GraffitiViewNew",{attrs:{countDownTime:t.countDownTime,options:t.options,isSubmit:t.GraffitIsSubmit},on:{submit:t.submitNotice}}):""!==t.isNewGraffiti?e("GraffitiView",{attrs:{countDownTime:t.countDownTime,options:t.options,isSubmit:t.GraffitIsSubmit},on:{submit:t.submitPhoto,photoData:t.getPhotoData}}):t._e(),e("UploadProgress",{attrs:{classType:t.classType,percent:t.percent,visible:t.showUploadProgress}})],1)},l=[],u=i("c7eb"),d=i("1da1"),h=(i("c19f"),i("ace4"),i("d3b7"),i("e260"),i("5cc6"),i("9a8c"),i("a975"),i("735e"),i("c1ac"),i("d139"),i("3a7b"),i("d5d6"),i("82f8"),i("e91f"),i("60bd"),i("5f96"),i("3280"),i("3fcc"),i("ca91"),i("25a1"),i("cd26"),i("3c5d"),i("2954"),i("649e"),i("219c"),i("170b"),i("b39a"),i("72f7"),i("b7ef"),i("907a"),i("986a"),i("1d02"),i("6ce5"),i("2834"),i("4ea1"),i("b64b"),i("99af"),i("8bbf")),g=i.n(h),m=i("753a"),p=i("c5f1"),A=function(t){Object(r["a"])(i,t);var e=Object(a["a"])(i);function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return console.info("函数申明 Main(opts)",n,"filePath:renderer/components/Classroom/CommonInteractions/graffiti/graffiti.js"),Object(o["a"])(this,i),t=e.call(this),t.options=n,t}return Object(s["a"])(i,[{key:"clearTipTimer",value:function(){this.tipTimer&&(clearTimeout(this.tipTimer),this.tipTimer=null)}},{key:"closeTip",value:function(t,e,i){if(t&&(this.clearTipTimer(),e>0))var n=setTimeout((function(){t.parentNode.removeChild(t),clearTimeout(n),n=null,i&&i()}),e)}},{key:"showShortCutTip",value:function(t){var e=t.duration,i=void 0===e?3e3:e,n=t.tips,o=JSON.parse(window.sessionStorage.getItem("photoWallShortCutTip"));if(!o){var s=document.createElement("div");s.setAttribute("class","shortCutTip animateTada"),s.innerHTML="\n      <p>".concat(n,"</p>\n    "),document.getElementById("graffitiContainer").appendChild(s),window.sessionStorage.setItem("photoWallShortCutTip",!0),this.closeTip(s,i)}}},{key:"showNotjoinTip",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.tips,i=t.callback,n=t.className,o=void 0===n?null:n,s=t.duration,r=void 0===s?3e3:s,a=t.dom,c=void 0===a?"graffitiContainer":a,f=document.createElement("div");f.setAttribute("class","notJoinTip ".concat(o||"")),f.innerHTML="\n      <p>".concat(e,"</p>\n    "),document.getElementById(c)&&document.getElementById(c).appendChild(f),this.closeTip(f,r,i)}},{key:"showCoinsTip",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.tips,i=t.coins,n=void 0===i?0:i,o=t.duration,s=void 0===o?3e3:o,r=t.callback,a=void 0===r?null:r,c=t.dom,f=void 0===c?"graffitiContainer":c,l=document.getElementById("submitTipContainer");l&&l.parentNode.removeChild(l);var u=document.createElement("div");n?(u.setAttribute("class","wallConisTip animateTada"),u.innerHTML='\n        <div class="coins">\n          <i></i> + '.concat(n,"\n        </div>\n        <p>").concat(e,"</p>\n      ")):(u.setAttribute("class","wallConisTip submitSuccessTip animateTada"),u.innerHTML="<p>".concat(e,"</p>")),document.getElementById(f)&&document.getElementById(f).appendChild(u),this.closeTip(u,s,a)}},{key:"showSubmitTip",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.duration,i=void 0===e?3e3:e,n=t.callback,o=void 0===n?null:n,s=t.text,r=t.icon,a=t.dom,c=void 0===a?"graffitiContainer":a,f="loading"===r?0:i,l=document.getElementById("submitTipContainer");l&&l.parentNode.removeChild(l);var u=document.createElement("div");u.setAttribute("id","submitTipContainer"),u.setAttribute("class","submitTipContainer"),u.innerHTML='\n      <div class="tipContainer">\n        '.concat(r?'<i class="'+r+'"></i>':"","\n        <p>").concat(s,"</p>\n      </div>\n    "),document.getElementById(c)&&document.getElementById(c).appendChild(u),this.closeTip(u,f,o)}},{key:"initCountdownTime",value:function(){var t=+new Date,e=this.options.roomMessage.roomInfo.commonOption.timeOffset,i=1e3*this.options.ircMsg.totalTime-(t+e-this.options.ircMsg.beginTime);return i}},{key:"interactOpen",value:function(){var t=Object(d["a"])(Object(u["a"])().mark((function t(){var e;return Object(u["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e={planId:1*this.options.roomMessage.roomInfo.stuLiveInfo.planId,classId:1*this.options.roomMessage.roomInfo.stuLiveInfo.classId,interactId:this.options.ircMsg.interactId},t.next=3,Object(p["b"])(e);case 3:case"end":return t.stop()}}),t,this)})));function e(){return console.info("函数申明 interactOpen, filePath:renderer/components/Classroom/CommonInteractions/graffiti/graffiti.js"),t.apply(this,arguments)}return e}()},{key:"submitPhoto",value:function(){var t=Object(d["a"])(Object(u["a"])().mark((function t(e,i){var n,o;return Object(u["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n={planId:1*this.options.roomMessage.roomInfo.stuLiveInfo.planId,classId:this.options.roomMessage.roomInfo.stuLiveInfo.classId,tutorId:this.options.roomMessage.roomInfo.stuLiveInfo.tutorId,photoPath:e,interactId:this.options.ircMsg.interactId,teacherId:this.options.roomMessage.roomInfo.teacherInfo.id},i&&(n.version=722),t.next=4,Object(p["d"])(n);case 4:return o=t.sent,0===o.code&&o.data&&g.a.prototype.$bus.$emit("updateAchievement","update"),console.log(o,"互动的金币"),t.abrupt("return",o);case 8:case"end":return t.stop()}}),t,this)})));function e(e,i){return console.info("函数申明 submitPhoto(_x, _x2)",e,i,"filePath:renderer/components/Classroom/CommonInteractions/graffiti/graffiti.js"),t.apply(this,arguments)}return e}()},{key:"getWallStatus",value:function(){var t=Object(d["a"])(Object(u["a"])().mark((function t(){var e,i;return Object(u["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e={planId:1*this.options.roomMessage.roomInfo.stuLiveInfo.planId,interactId:this.options.ircMsg.interactId},t.next=3,Object(p["a"])(e);case 3:return i=t.sent,t.abrupt("return",i);case 5:case"end":return t.stop()}}),t,this)})));function e(){return console.info("函数申明 getWallStatus, filePath:renderer/components/Classroom/CommonInteractions/graffiti/graffiti.js"),t.apply(this,arguments)}return e}()},{key:"submitGratiffi",value:function(){var t=Object(d["a"])(Object(u["a"])().mark((function t(){var e,i;return Object(u["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e={planId:1*this.options.roomMessage.roomInfo.stuLiveInfo.planId,classId:this.options.roomMessage.roomInfo.stuLiveInfo.classId,tutorId:this.options.roomMessage.roomInfo.stuLiveInfo.tutorId,interactId:this.options.ircMsg.interactId,version:722},t.next=3,Object(p["c"])(e);case 3:return i=t.sent,t.abrupt("return",i);case 5:case"end":return t.stop()}}),t,this)})));function e(){return console.info("函数申明 submitGratiffi, filePath:renderer/components/Classroom/CommonInteractions/graffiti/graffiti.js"),t.apply(this,arguments)}return e}()}]),i}(m["a"]),v=function(){var t=this,e=t._self._c;return e("div",{staticClass:"photoShotContainer"},[e("GratiffiTools",{attrs:{minutes:t.minutes,seconds:t.seconds,isSubmit:t.isSubmit},on:{graffitiDraw:t.graffitiDraw,graffitiEraser:t.graffitiEraser,confirm:t.confirm}}),e("div",{staticClass:"graffitiWrapper",attrs:{id:"graffitiWrapper"}})],1)},b=[],w=(i("a9e3"),i("4d90"),i("25f0"),i("6e4d")),C=i.n(w),I=i("e39c"),y=i("b047"),S=i.n(y),O=function(){var t=this,e=t._self._c;return e("div",{staticClass:"tools"},[e("div",{staticClass:"graffitiTools"},[e("i",{staticClass:"draw draw-yellow select",on:{click:function(e){return t.graffitiDraw("yellow","#ffcf1b",e)}}},[t._v(" "+t._s(t.$t("classroom.interactions.graffiti.yellow"))+" ")]),e("i",{staticClass:"draw draw-red",on:{click:function(e){return t.graffitiDraw("red","#ff503f",e)}}},[t._v(" "+t._s(t.$t("classroom.interactions.graffiti.red"))+" ")]),e("i",{staticClass:"draw draw-blue",on:{click:function(e){return t.graffitiDraw("blue","#1572ff",e)}}},[t._v(" "+t._s(t.$t("classroom.interactions.graffiti.blue"))+" ")]),e("i",{staticClass:"draw eraser",on:{click:t.graffitiEraser}})]),e("div",{staticClass:"userTools"},[e("div",{staticClass:"time"},[e("div",{staticClass:"minutes"},[e("span",{staticClass:"line"}),e("span",{staticClass:"num"},[t._v(t._s(t.minutes))])]),t._m(0),e("div",{staticClass:"seconds"},[e("span",{staticClass:"line"}),e("span",{staticClass:"num"},[t._v(t._s(t.seconds))])])]),e("a-button",{staticClass:"submit-btn",class:{"is-submit":t.isSubmit},attrs:{shape:"round",disabled:t.isSubmit},on:{click:t.confirm}},[t._v(" "+t._s(t.$t("common.done"))+" ")])],1)])},B=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"dots"},[e("span"),e("span")])}],T=(i("159b"),{name:"GratiffiTools",props:{minutes:{type:String,default:"00"},seconds:{type:String,default:"00"},isSubmit:{style:Boolean,default:!1}},methods:{graffitiDraw:function(t,e,i){console.info("对象函数 graffitiDraw(abstractColor, specificColor, e)",t,e,i,"filePath:renderer/components/Classroom/CommonInteractions/graffiti/components/graffitiTools.vue"),i&&this.setClass(i.target),this.$emit("graffitiDraw",t,e)},graffitiEraser:function(t){console.info("对象函数 graffitiEraser(e)",t,"filePath:renderer/components/Classroom/CommonInteractions/graffiti/components/graffitiTools.vue"),this.setClass(t.target),this.$emit("graffitiEraser")},setClass:function(t){console.info("对象函数 setClass(target)",t,"filePath:renderer/components/Classroom/CommonInteractions/graffiti/components/graffitiTools.vue"),t.parentNode.children.forEach((function(t){Object(I["y"])(t,"select")})),Object(I["a"])(t,"select")},confirm:function(){console.info("对象函数 confirm,filePath:renderer/components/Classroom/CommonInteractions/graffiti/components/graffitiTools.vue"),this.$emit("confirm")}}}),k=T,M=(i("00d9"),i("2877")),N=Object(M["a"])(k,O,B,!1,null,"bf7a062e",null),D=N.exports,j=i("d0db"),W={name:"smallClassGraffiti",props:{closeInteractive:{style:Boolean,default:!1},isSubmit:{style:Boolean,default:!1},countDownTime:{type:Number,default:0},options:{type:Object,default:function(){}}},data:function(){return{graffiti:null,dialogVisible:!1,dialogContent:null,dialogDescription:null,timer:null,minutes:"00",seconds:"00",graffitiInit:{dom:"graffitiWrapper",width:840,height:630,quality:.8,lineColor:"#ffcf1b",background:"",lineSize:3},eraserSize:25}},components:{GratiffiTools:D},mounted:function(){var t=this;this.renderCountDown(),this.$nextTick(Object(d["a"])(Object(u["a"])().mark((function e(){return Object(u["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.initGraffitiDraw();case 1:case"end":return e.stop()}}),e)})))),window.addEventListener("resize",this.setGraffitiScale)},computed:{},methods:{initGraffitiDraw:function(){var t=this;return Object(d["a"])(Object(u["a"])().mark((function e(){var i;return Object(u["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.info("对象函数 initGraffitiDraw,filePath:renderer/components/Classroom/CommonInteractions/graffiti/components/graffiti.vue"),i=document.querySelector("#graffitiContainer"),t.graffitiInit.width=i.clientWidth,t.graffitiInit.height=i.clientHeight,console.log(t.options,"this.options"),t.sendLogger("涂鸦画板this.options : ".concat(JSON.stringify(t.options))),t.graffitiInit.background=t.options.ircMsg.imageUrl||"#000000",e.next=9,C.a.init(t.graffitiInit);case 9:t.graffiti=e.sent,t.graffiti.setAttribute("class","yellow_penCursor"),C.a.draw();case 12:case"end":return e.stop()}}),e)})))()},renderCountDown:function(){console.info("对象函数 renderCountDown,filePath:renderer/components/Classroom/CommonInteractions/graffiti/components/graffiti.vue"),this.countDown(),this.timer=setInterval(this.countDown,1e3)},setGraffitiScale:S()((function(){var t=document.querySelector("#graffitiContainer"),e=document.querySelector("#graffitiWrapper");if(t){var i=t.querySelector("canvas"),n=t.querySelector("img");e.firstChild.style.width=e.style.width=n.style.width=i.style.width=t.clientWidth+"px",e.firstChild.style.height=e.style.height=n.style.height=i.style.height=t.clientHeight+"px"}}),300),graffitiDraw:function(t,e){console.info("对象函数 graffitiDraw(abstractColor, specificColor)",t,e,"filePath:renderer/components/Classroom/CommonInteractions/graffiti/components/graffiti.vue"),this.graffiti.setAttribute("class","".concat(t,"_penCursor")),C.a.lineColor(e),C.a.draw()},graffitiEraser:function(){console.info("对象函数 graffitiEraser,filePath:renderer/components/Classroom/CommonInteractions/graffiti/components/graffiti.vue"),this.graffiti.setAttribute("class","eraserCursor"),C.a.eraser(this.eraserSize)},createImage:function(){var t=this;return Object(d["a"])(Object(u["a"])().mark((function e(){var i;return Object(u["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.info("对象函数 createImage,filePath:renderer/components/Classroom/CommonInteractions/graffiti/components/graffiti.vue"),e.next=3,C.a.createImage();case 3:i=e.sent,console.log("res"),0===i.errCode&&(t.sendLogger("生成涂鸦图片 : ".concat(JSON.stringify(i.data))),t.$emit("photoData",i.data));case 6:case"end":return e.stop()}}),e)})))()},confirm:function(){var t=this;return Object(d["a"])(Object(u["a"])().mark((function e(){return Object(u["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.info("对象函数 confirm,filePath:renderer/components/Classroom/CommonInteractions/graffiti/components/graffiti.vue"),t.sendLogger("涂鸦画板学生点击提交"),e.next=4,t.createImage();case 4:t.$emit("submit");case 5:case"end":return e.stop()}}),e)})))()},countDown:function(){if(console.info("对象函数 countDown,filePath:renderer/components/Classroom/CommonInteractions/graffiti/components/graffiti.vue"),this.countDownTime>=0){var t=Math.floor(this.countDownTime/60),e=Math.floor(this.countDownTime%60);this.countDownTime=this.countDownTime-1,this.minutes=t.toString().padStart(2,"0"),this.seconds=e.toString().padStart(2,"0")}else clearInterval(this.timer)},sendLogger:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";j["a"].send({tag:"student.Interact",content:{msg:t,interactType:"Graffiti",interactId:"",interactStage:e}})}},beforeDestroy:function(){console.info("对象函数 beforeDestroy,filePath:renderer/components/Classroom/CommonInteractions/graffiti/components/graffiti.vue"),window.removeEventListener("resize",this.setGraffitiScale),C.a.destroy(),console.log("Graffiti destroy"),this.sendLogger("关闭互动"),this.timer&&clearInterval(this.timer)},watch:{closeInteractive:function(t){console.info("对象函数 closeInteractive(val)",t,"filePath:renderer/components/Classroom/CommonInteractions/graffiti/components/graffiti.vue"),t&&this.createImage()}}},$=W,x=(i("99f5"),Object(M["a"])($,v,b,!1,null,"71ffa29c",null)),L=x.exports,R=function(){var t=this,e=t._self._c;return e("div",{staticClass:"photoShotContainer photoShotNewContainer"},[e("GratiffiTools",{ref:"GratiffiTools",attrs:{minutes:t.minutes,seconds:t.seconds,isSubmit:t.isSubmit},on:{graffitiDraw:t.graffitiDraw,graffitiEraser:t.graffitiEraser,confirm:t.confirm}}),e("div",{staticClass:"graffitiWrapper graffitiNewWrapper",attrs:{id:"graffitiWrapper"}},[e("img",{attrs:{id:"gratiffiImg",src:i("85e5")},on:{load:function(e){return t.handleImgLoad(e)},error:function(e){return t.handleImgError(e)}}}),e("white-board-canvas",{ref:"WhiteBoardNew"}),e("white-board-tools",{ref:"WhiteBoardTools"})],1),t.teacherWatching?e("div",{staticClass:"teacher-watching-label"},[t._v(" "+t._s(t.$t("common.teacherWatching"))+" ")]):t._e()],1)},E=[],G=i("2909"),P=(i("14d9"),i("e6cf"),i("3ca3"),i("ddb0"),i("0481"),i("4069"),i("20bf"),i("f3f2")),Q=i.n(P),_=(i("bcac"),i("281f")),H=i.n(_),K=(i("8d67"),i("612a")),U=i("97a4"),F=i("c02a"),q=i("c58d"),J={name:"smallClassGraffitiNew",props:{closeInteractive:{style:Boolean,default:!1},isSubmit:{style:Boolean,default:!1},countDownTime:{type:Number,default:0},options:{type:Object,default:function(){}}},data:function(){return{dialogVisible:!1,dialogContent:null,dialogDescription:null,timer:null,minutes:"00",seconds:"00",isBanned:!1,currentThickness:4,currentLineDashed:!1,containerWidth:0,containerHeight:0,gratiffiMsgArray:[],teacherWatching:!1,eraserSize:50,countDownTimeCopy:null,canvasScale:2}},components:{WhiteBoardCanvas:Q.a.WhiteBoardCanvas,WhiteBoardTools:H.a,GratiffiTools:D},mounted:function(){var t=this;return Object(d["a"])(Object(u["a"])().mark((function e(){return Object(u["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.teacherIsWatchingMe(K["a"].state.smallClass.gratiffiBoardWatchingInfo),e.next=3,Object(q["a"])();case 3:t.canvasScale=e.sent,t.$nextTick(Object(d["a"])(Object(u["a"])().mark((function e(){var i;return Object(u["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.initBoard(),t.listenerSignalService(),t.options.ircMsg.imageUrl&&(i=document.querySelector("#gratiffiImg"),t.sendLogger("涂鸦画板更换背景图 ".concat(i,",").concat(t.options.ircMsg.imageUrl)),i.src=t.options.ircMsg.imageUrl),t.sendLogger("this.options, ".concat(JSON.stringify(t.options)));case 4:case"end":return e.stop()}}),e)})))),t.renderCountDown(),window.addEventListener("resize",t.setGraffitiScale);case 7:case"end":return e.stop()}}),e)})))()},computed:{roomInfo:function(){return this.options.roomMessage.roomInfo}},watch:{teacherWatching:function(t){t&&this.sendGratiffiMsg()}},methods:{handleImgLoad:function(t){this.sendLogger("涂鸦画板背景图加载成功",{url:t.target.src})},handleImgError:function(t){console.error("涂鸦画板背景图加载失败",t.target.src),this.sendLogger("涂鸦画板背景图加载失败",{url:t.target.src},"error")},initBoard:function(){var t=this;this.getCurrentCanvasSize();var e={canvas:{penType:"Bspline",strokeType:"none",scale:this.canvasScale,pageChangeReport:!1,sendRoomCanvasMessage:this.sendRoomCanvasMessage.bind(this),getHistoryMessage:this.getHistoryMessage.bind(this),enableKeyboardDelete:!0,enableFittingShape:!1},common:{liveId:String(this.roomInfo.planInfo.id),role:"student",dataVersion:"1",courseId:"",userId:this.roomInfo.stuInfo.id+"",userName:this.roomInfo.stuInfo.nickName,screenWidth:this.containerWidth,screenHeight:this.containerHeight,roomIds:[this.roomInfo.commonOption.roomlist[0]],fastFrequency:2e3,slowFrequency:3e3,serverTimestamp:+new Date+this.roomInfo.commonOption.timeOffset},accessControl:{showMenu:!1,mode:"itsAndCanvas",isBanned:this.isBanned,enableHistoryMessage:!0,showCursor:!0,enableRetrySend:!0,enableLogSend:!1,enableFittingShape:!1}};if(console.log("涂鸦初始化参数",e,this.$refs),this.sendLogger("涂鸦初始化参数, ".concat(JSON.stringify(e))),this.$refs.WhiteBoardNew){this.$refs.WhiteBoardNew.uninit(),this.$refs.WhiteBoardNew.init(e),this.$refs.WhiteBoardNew.handleMouse("default");var i=this.$refs.WhiteBoardNew.getMainBoardHandWritting(),n=this.$refs.WhiteBoardNew.getPluginManager(),o=this.$refs.WhiteBoardNew,s="".concat(this.roomInfo.stuInfo.id,"_").concat(this.options.ircMsg.dbkey,"#").concat(this.roomInfo.stuInfo.id),r=s.split("_")[5];this.$refs.WhiteBoardTools.init(o,i,n);var a=[11,12,13,14,15,1e3];a.forEach((function(e){1e3===e?n.registerEvent("WhiteboardResize",e,t.toolsMessageHandler("WhiteboardResize",e,String(r))):n.registerEvent("ReceiveBinaryData",e,t.toolsMessageHandler("ReceiveBinaryData",e,String(r)))})),this.$refs.WhiteBoardTools.setWBToolsStatus(!1),this.$refs.WhiteBoardTools.handleMenuEnable(!1),this.$refs.WhiteBoardNew.handleResetImComingDbkey(s),this.$refs.WhiteBoardNew.handlePageChange(String(r)),this.$refs.WhiteBoardTools.handlePageChange(String(r)),this.$refs.GratiffiTools.graffitiDraw("yellow","#ffcf1b")}},toolsMessageHandler:function(t,e,i){var n=this;return function(o){n.$refs.WhiteBoardTools.receiveBinaryData(t,e,i,o)}},sendRoomCanvasMessage:function(t,e){this.teacherWatching?(this.thinkClass.SignalService.sendRoomBinMessage([this.roomInfo.commonOption.roomlist[0]],"".concat(this.options.ircMsg.dbkey,"#").concat(this.roomInfo.stuInfo.id),e.keyMsgId,e.content),this.sendLogger("发送涂鸦画板涂鸦消息:".concat(e.dbKey," ").concat(e.keyMsgId))):(this.gratiffiMsgArray.push(e),this.$refs.WhiteBoardNew&&this.$refs.WhiteBoardNew.handleSendMessageSuccess(e.dbKey,e.keyMsgId),this.sendLogger("保存涂鸦画板涂鸦消息:".concat(e.dbKey," ").concat(e.keyMsgId)))},getHistoryMessage:function(t){var e=this,i="".concat(this.options.ircMsg.dbkey,"#").concat(this.roomInfo.stuInfo.id),n="teacher_".concat(i);console.log("拉取历史消息dbkey",i,n);var o=[i,n];this.sendLogger("拉取历史消息dbkey :".concat(JSON.stringify(o)));var s=[];o.forEach((function(t){s.push(Object(U["a"])({dbkey:t,appId:K["a"].state.smallClass.baseData.configs.ircAk,sk:K["a"].state.smallClass.baseData.configs.ircSk,businessId:3,liveId:K["a"].state.smallClass.baseData.planInfo.id,ircApiHost:K["a"].state.smallClass.baseData.configs.ircApiHost}))})),Promise.all(s).then((function(t){console.log("resAll",t);var i=t.flat();try{e.$refs.WhiteBoardNew&&e.$refs.WhiteBoardNew.handleRecoverHistoryMessage([{content:i}])}catch(n){console.error(n)}})).catch((function(t){console.error(t)}))},listenerSignalService:function(){this.thinkClass.SignalService.on("onGetRoomHistoryBinMessageNotice",this.handleOnGetRoomHistoryBinMessageNotice),this.thinkClass.SignalService.on("onRecvRoomDataUpdateNotice",this.handleOnRecvRoomDataUpdateNotice),this.thinkClass.SignalService.on("onRecvRoomBinMessageNotice",this.handleOnRecvRoomBinMessageNotice),this.thinkClass.SignalService.on("onSendRoomBinMessageResp",this.handleOnSendRoomBinMessageResp)},handleOnGetRoomHistoryBinMessageNotice:function(t){console.log("监听信令历史消息",t),this.sendLogger("监听信令历史消息 :".concat(JSON.stringify(t)));var e=t;if(Array.isArray(e)){e.forEach((function(t,i){e[i].content=Uint8Array.from(t.content)}));try{this.$refs.WhiteBoardNew&&this.$refs.WhiteBoardNew.handleRecoverHistoryMessage([{content:e}])}catch(i){this.sendLogger("涂鸦sdk报错 ".concat(i),{},"error")}}else this.sendLogger("涂鸦历史消息格式错误 res: ".concat(JSON.stringify(res)),{},"error")},handleOnRecvRoomDataUpdateNotice:function(t){var e=t.key,i=t.noticeContent;"graffiti_board_watching"===e&&(this.sendLogger("老师正在查看学生涂鸦 :".concat(JSON.stringify(i))),console.log("teacherWatching",i),this.teacherIsWatchingMe(i))},handleOnRecvRoomBinMessageNotice:function(t){this.$refs.WhiteBoardNew&&this.$refs.WhiteBoardNew.handleRoomCanvasMessage(t)},handleOnSendRoomBinMessageResp:function(t){0===t.code?this.$refs.WhiteBoardNew&&this.$refs.WhiteBoardNew.handleSendMessageSuccess(t.dbKey,t.keyMsgId):(this.$refs.WhiteBoardNew&&this.$refs.WhiteBoardNew.handleSendMessageError(t.code,t.msg,t.dbKey,t.keyMsgId),this.sendLogger("涂鸦发送失败:".concat("code:"+t.code+"msg:"+t.msg+"dbKey:"+t.dbKey+"keyMsgId:"+t.keyMsgId),{},"error"))},teacherIsWatchingMe:function(t){this.teacherWatching=t.studentId===this.roomInfo.stuInfo.id},sendGratiffiMsg:function(){var t=this,e=Object(G["a"])(this.gratiffiMsgArray);this.gratiffiMsgArray=[],e.forEach((function(e){t.thinkClass.SignalService.sendRoomBinMessage([t.roomInfo.commonOption.roomlist[0]],"".concat(t.options.ircMsg.dbkey,"#").concat(t.roomInfo.stuInfo.id),e.keyMsgId,e.content),t.sendLogger("发送涂鸦画板保存的涂鸦消息:".concat(e.dbKey," ").concat(e.keyMsgId))}))},getCurrentCanvasSize:function(){var t=document.querySelector("#graffitiContainer");this.containerWidth=t.clientWidth,this.containerHeight=t.clientHeight},renderCountDown:function(){this.countDownTimeCopy=this.countDownTime,this.countDown(),this.timer=setInterval(this.countDown,1e3)},graffitiDraw:function(t,e){if(this.$refs.WhiteBoardNew){console.log("specificColor",e);var i={color:e,thickness:this.currentThickness,lineDashed:this.currentLineDashed};this.$refs.WhiteBoardNew.setPenStyle(i),this.$refs.WhiteBoardNew.handlePen(),this.sendLogger("选择了涂鸦画笔, ".concat(JSON.stringify(i)))}else this.sendLogger("选择了涂鸦画笔, 但是未获得涂鸦工具WhiteBoardNew")},graffitiEraser:function(){this.$refs.WhiteBoardNew.setEraserStyle(this.eraserSize),this.$refs.WhiteBoardNew.handleEraser(),this.sendLogger("选择了涂鸦橡皮擦, ".concat(JSON.stringify({eraserSize:this.eraserSize})))},setGraffitiScale:S()((function(){this.getCurrentCanvasSize(),this.$refs.WhiteBoardNew&&this.$refs.WhiteBoardNew.handleResizeCanvas(this.containerWidth,this.containerHeight,!0)}),300),confirm:function(){var t=this;return Object(d["a"])(Object(u["a"])().mark((function e(){var i;return Object(u["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:F["j"](null===(i=t.options)||void 0===i?void 0:i.ircMsg),t.sendLogger("涂鸦画板学生点击提交"),t.$emit("submit");case 3:case"end":return e.stop()}}),e)})))()},countDown:function(){if(this.countDownTimeCopy>=0){var t=Math.floor(this.countDownTimeCopy/60),e=Math.floor(this.countDownTimeCopy%60);this.countDownTimeCopy=this.countDownTimeCopy-1,this.minutes=t.toString().padStart(2,"0"),this.seconds=e.toString().padStart(2,"0")}else clearInterval(this.timer)},sendLogger:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"info";j["a"].send({tag:"student.Interact",content:Object(n["a"])({msg:t,interactType:"Graffiti",interactId:""},e),level:i})},removeListenerSignalService:function(){this.thinkClass.SignalService.off("onGetRoomHistoryBinMessageNotice",this.handleOnGetRoomHistoryBinMessageNotice),this.thinkClass.SignalService.off("onRecvRoomDataUpdateNotice",this.handleOnRecvRoomDataUpdateNotice),this.thinkClass.SignalService.off("onRecvRoomBinMessageNotice",this.handleOnRecvRoomBinMessageNotice),this.thinkClass.SignalService.off("onSendRoomBinMessageResp",this.handleOnSendRoomBinMessageResp)}},beforeDestroy:function(){K["a"].dispatch("smallClass/updateGraffitiBoardWatchingStutus",{}),this.removeListenerSignalService(),this.$refs.WhiteBoardNew.uninit(),window.removeEventListener("resize",this.setGraffitiScale),this.timer&&clearInterval(this.timer)}},V=J,z=(i("b8f9"),Object(M["a"])(V,R,E,!1,null,"137be83e",null)),Z=z.exports,Y=i("1a37"),X=function(){var t=this,e=t._self._c;return t.visible?e("div",{staticClass:"progressContainer"},[e("div",{staticClass:"progress",class:2==t.classType?"progress-small-class":"progress-normal-class"},[e("div",{staticClass:"progress-text"},[t._v(t._s(t.$t("common.uploading"))+"… "+t._s(t.percent)+"%")]),e("a-progress",{attrs:{percent:t.percent,"stroke-color":{"0%":"rgba(255,213,24,1)","100%":"rgba(255,170,10,1)"},strokeWidth:4,showInfo:!1}})],1)]):t._e()},tt=[],et={name:"photoWallProgress",props:{visible:{type:Boolean,default:!0},percent:{type:Number,default:0},classType:{type:Number,default:0}},methods:{}},it=et,nt=(i("eb0e"),Object(M["a"])(it,X,tt,!1,null,"f621ddb4",null)),ot=nt.exports,st={name:"Graffiti",props:{options:{type:Object,default:function(){}}},components:{GraffitiView:L,GraffitiViewNew:Z,UploadProgress:ot},data:function(){return{graffitiOptions:null,showUploadProgress:!1,closeInteractive:!1,countDownTime:0,classType:0,isSubmit:!1,isNewGraffiti:"",GraffitIsSubmit:!1}},created:function(){this.graffitiOptions=new A(Object(n["a"])({},this.options)),this.countDownTime=parseFloat(this.graffitiOptions.initCountdownTime()/1e3)||0,this.sendLogger("涂鸦画板互动开始倒计时, ".concat(this.countDownTime,"s")),this.classType=this.options.roomMessage.roomInfo.commonOption.classType},mounted:function(){var t=this;this.userTrackLogger("涂鸦画板启动"),this.$nextTick(Object(d["a"])(Object(u["a"])().mark((function e(){return Object(u["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.isNewGraffiti=t.options.ircMsg.dbkey,t.sendLogger("收到涂鸦画板互动, 信令内容为: ".concat(JSON.stringify(t.options.ircMsg)),"start"),t.$bus.$emit("photoWallInteractId",t.options.ircMsg.interactId),localStorage.setItem("photoWallOptions",JSON.stringify(t.options)),t.getWallStatus(),t.graffitiOptions.interactOpen();case 6:case"end":return e.stop()}}),e)}))))},computed:{},methods:{getPhotoData:function(t){this.photoData=t},submitPhoto:function(t){var e=this;return Object(d["a"])(Object(u["a"])().mark((function i(){var n,o,s,r,a,c;return Object(u["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(!e.submiting){i.next=2;break}return i.abrupt("return");case 2:return e.dialogVisible=e.showPhotoShotTip=!1,e.submiting=e.showUploadProgress=!0,n=new Y["b"]({scene:"pictureWall"}),i.next=7,n.putFile({filePath:"pictureWall.jpg",file:t||e.photoData.blob,progress:function(t){console.log(t,"percent==="),e.percent=t},success:function(t){console.log(t,"上传照片"),e.sendLogger("上传照片成功, url: ".concat(t.url))},fail:function(t){e.showUploadProgress=!1,e.submiting=!1,e.percent=0,e.graffitiOptions.showSubmitTip({text:e.$t("common.uploadFailed"),icon:"error",callback:function(){}}),console.error("上传照片失败",t),e.sendLogger("上传照片失败")}});case 7:if(o=i.sent,s=o.key,console.log(s,"uploadKey"),!s){i.next=32;break}return e.showUploadProgress=!1,i.next=14,e.graffitiOptions.submitPhoto(s,e.isNewGraffiti);case 14:if(r=i.sent,0!==r.code){i.next=25;break}if(e.GraffitIsSubmit=!0,e.isNewGraffiti&&(e.isSubmit=!0),null!==r&&void 0!==r&&null!==(a=r.data)&&void 0!==a&&a.rightCoin&&!e.isNewGraffiti){i.next=20;break}return i.abrupt("return");case 20:c=r.data.rightCoin,e.graffitiOptions.showCoinsTip({coins:c,tips:e.$t("common.sumbittedSuccessfully"),callback:function(){e.isSubmit=!0}}),e.sendLogger("获得金币成功, ".concat(JSON.stringify(r))),i.next=32;break;case 25:if(e.submiting=!1,e.isSubmit=!0,e.percent=0,!e.isNewGraffiti){i.next=30;break}return i.abrupt("return");case 30:e.graffitiOptions.showSubmitTip({text:e.$t("common.submissionFailed"),icon:"error",callback:function(){}}),e.sendLogger("获得金币失败, ".concat(JSON.stringify(r)));case 32:case"end":return i.stop()}}),i)})))()},stopGratiffi:function(){var t=this;return Object(d["a"])(Object(u["a"])().mark((function e(){var i,n,o,s,r,a,c,f,l;return Object(u["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:console.log("停止作答"),t.sendLogger("老师发送停止作答"),i=document.querySelector("#graffitiContainer"),n=i.clientWidth,o=i.clientHeight,s=document.createElement("canvas"),s.width=n,s.height=o,r=document.querySelector("#gratiffiImg"),a=document.querySelector("#graffitiWrapper .canvas-container .canvas-shape"),c=document.querySelector("#graffitiWrapper .canvas-container .canvas-main"),s.getContext("2d").drawImage(r,0,0,n,o),s.getContext("2d").drawImage(a,0,0,n,o),s.getContext("2d").drawImage(c,0,0,n,o),f=s.toDataURL(),l=t.base64ToBlob(f,"image/jpeg"),t.submitPhoto(l);case 17:case"end":return e.stop()}}),e)})))()},submitNotice:function(){var t=this;return Object(d["a"])(Object(u["a"])().mark((function e(){var i,n,o;return Object(u["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("学员提交涂鸦"),t.sendLogger("学员提交涂鸦"),e.next=4,t.graffitiOptions.submitGratiffi();case 4:if(i=e.sent,0!==i.code){e.next=13;break}if(t.GraffitIsSubmit=!0,null!==i&&void 0!==i&&null!==(n=i.data)&&void 0!==n&&n.rightCoin){e.next=9;break}return e.abrupt("return");case 9:o=i.data.rightCoin,t.graffitiOptions.showCoinsTip({coins:o,tips:t.$t("common.sumbittedSuccessfully"),callback:function(){}}),t.sendLogger("获得金币成功, ".concat(JSON.stringify(i))),t.$bus.$emit("addCoin",!0,o);case 13:case"end":return e.stop()}}),e)})))()},base64ToBlob:function(t,e){for(var i=window.atob(t.split(",")[1]),n=new ArrayBuffer(i.length),o=new Uint8Array(n),s=0;s<i.length;s++)o[s]=i.charCodeAt(s);return new Blob([n],{type:e})},sendLogger:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";j["a"].send({tag:"student.Interact",content:{msg:t,interactType:"Photopost",interactId:"",interactStage:e}})},userTrackLogger:function(t){j["a"].send({tag:"userTrack",content:{msg:t,tag:"student.Interact",interactType:"Photopost"}})},getWallStatus:function(){var t=this;return Object(d["a"])(Object(u["a"])().mark((function e(){var i,n,o;return Object(u["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.graffitiOptions.getWallStatus();case 3:i=e.sent,n=i.code,o=i.data,0===n&&(t.isSubmit=o.isSubmit),e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](0),console.error("异常恢复error",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))()},destroyInteraction:function(){var t=this;return Object(d["a"])(Object(u["a"])().mark((function e(){return Object(u["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.closeInteractive=!0,t.photoData||t.isSubmit||t.submiting||t.graffitiOptions.showNotjoinTip({className:"notJoin",tips:t.$t("classroom.interactions.photoWall.notjoinTip"),callback:function(){t.destroy()}});case 2:case"end":return e.stop()}}),e)})))()},destroy:function(){var t;this.$destroy(),null===(t=this.$el)||void 0===t||null===(t=t.parentNode)||void 0===t||t.removeChild(this.$el),this.$bus.$emit("photoWallInteractId",null),this.userTrackLogger("涂鸦画板结束")}}},rt=st,at=(i("efd45"),Object(M["a"])(rt,f,l,!1,null,"4e684620",null)),ct=at.exports,ft=function(t){Object(r["a"])(i,t);var e=Object(a["a"])(i);function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return console.info("函数申明 Graffiti(opts)",n,"filePath:renderer/components/Classroom/CommonInteractions/graffiti/index.js"),Object(o["a"])(this,i),t=e.call(this,ct),t.options=n,t.dom=n.roomMessage.roomInfo.interactionController,t.initVmApp("涂鸦画板"),t}return Object(s["a"])(i,[{key:"createPropsData",value:function(){var t={};return Object(n["a"])({options:this.options},t)}}]),i}(c["a"])},"99f5":function(t,e,i){"use strict";i("0219")},"9a0c":function(t,e,i){"use strict";var n=i("342f");t.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(n)},a2bf:function(t,e,i){"use strict";var n=i("e8b5"),o=i("07fa"),s=i("3511"),r=i("0366"),a=function(t,e,i,c,f,l,u,d){var h,g,m=f,p=0,A=!!u&&r(u,d);while(p<c)p in i&&(h=A?A(i[p],p,e):i[p],l>0&&n(h)?(g=o(h),m=a(t,e,h,g,m,l-1)-1):(s(m+1),t[m]=h),m++),p++;return m};t.exports=a},b6c9:function(t,e,i){"use strict";i.d(e,"a",(function(){return f}));var n=i("d4ec"),o=i("bee2"),s=(i("99af"),i("d9e2"),i("8bbf")),r=i.n(s),a=i("3898"),c=i("d0db"),f=function(){function t(e){console.info("函数申明 InteractionBase(app)",e,"filePath:renderer/components/Classroom/CommonInteractions/interaction-base.js"),Object(n["a"])(this,t),this.app=e,this.vm=null,this.keepOtherDom=!1}return Object(o["a"])(t,[{key:"initVmApp",value:function(t){if(!this.dom)throw Error("互动的dom容器不存在");this.dom.children.length>0&&!this.keepOtherDom&&(c["a"].send({tag:"tempInteractionTest",content:{msg:"清空互动容器，由".concat(t,"触发清空，清空").concat(this.dom.children[0].className)}}),this.dom.innerHTML=""),this.vm=this.initVm(this.app),this.render(this.dom,this.vm)}},{key:"initVm",value:function(t){var e=r.a.extend(t),i=this.createPropsData(),n=new e({i18n:a["b"],propsData:i,store:this.store||{}});return n.$mount(),n}},{key:"render",value:function(t,e){t.appendChild(e.$el)}},{key:"destroy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.submit,i=t.key,n=void 0===i?"":i;if(this.vm){var o,s;if(e&&this.vm.submit(),this.vm.$destroy(),"classRest"===n)null===this||void 0===this||null===(o=this.dom)||void 0===o||o.removeChild(null===this||void 0===this||null===(s=this.vm)||void 0===s?void 0:s.$el);else this.dom.innerHTML="";this.vm=null,this.app=null}}},{key:"getProperties",value:function(t,e){return t["".concat(e)].properties}},{key:"handleMsg",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};console.log(t)}}]),t}()},b8f9:function(t,e,i){"use strict";i("5f7f")},e996:function(t,e,i){},eb0e:function(t,e,i){"use strict";i("e996")},efd45:function(t,e,i){"use strict";i("9093")}}]);
//# sourceMappingURL=chunk-06d6e3d4.f5428fc1.js.map