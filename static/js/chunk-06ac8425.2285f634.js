(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-06ac8425"],{"2c09":function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"c",(function(){return u})),n.d(t,"d",(function(){return l})),n.d(t,"b",(function(){return m}));var r=n("c7eb"),s=n("1da1"),a=n("dc21"),o=n("e39c"),i=function(){var e=Object(s["a"])(Object(r["a"])().mark((function e(t,n){var s,i,c;return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s=Object(o["h"])(),i=s.oversea,e.next=3,Object(a["a"])({url:t,params:n,apiDomain:i});case 3:return c=e.sent,e.abrupt("return",c);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),c=function(){var e=Object(s["a"])(Object(r["a"])().mark((function e(t){var n,s;return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n="/classroom-hub/question/student/game/status",e.next=3,i(n,t);case 3:return s=e.sent,e.abrupt("return",s);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),u=function(){var e=Object(s["a"])(Object(r["a"])().mark((function e(t){var n,s;return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n="/classroom-hub/question/student/game/submit",e.next=3,i(n,t);case 3:return s=e.sent,e.abrupt("return",s);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),l=function(){var e=Object(s["a"])(Object(r["a"])().mark((function e(t){var n,s;return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n="/classroom-hub/question/student/game/submitAsync",e.next=3,i(n,t);case 3:return s=e.sent,e.abrupt("return",s);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),m=function(){var e=Object(s["a"])(Object(r["a"])().mark((function e(t,n){var s;return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s="open"===t?"/classroom-hub/classroom/student/interact/partakereport":"/classroom-hub/question/student/game/close",e.next=3,i(s,n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},a611:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return R}));var r=n("5530"),s=n("d4ec"),a=n("bee2"),o=n("262e"),i=n("2caf"),c=n("b6c9"),u=function(){var e=this,t=e._self._c;return e.showGame?t("NeGamecourseware",{attrs:{gameUrl:e.gameUrl,nickName:e.nickName,role:e.role,isAnswer:e.isAnswer,lang:e.lang,showResultToast:e.showResultToast,rightCoin:e.rightCoin},on:{submit:e.submitAnswer,exit:e.destroy,loaded:e.gameLoaded,reload:e.gameReload,fail:e.gameFail}}):e._e()},l=[],m=n("c7eb"),d=n("1da1"),p=(n("14d9"),n("99af"),n("d3b7"),n("159b"),n("ac1f"),n("1276"),n("0d52")),h=n("ceab"),g=n("c5ee"),f=n("e39c"),b=n("2909"),v=n("753a"),w=n("2c09"),O=function(e){Object(o["a"])(n,e);var t=Object(i["a"])(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return console.info("函数申明 Game(opts)",r,"filePath:renderer/components/Classroom/CommonInteractions/gameCourseware/game.js"),Object(s["a"])(this,n),e=t.call(this),e.options=r,e}return Object(a["a"])(n,[{key:"submitPics",value:function(){var e=Object(d["a"])(Object(m["a"])().mark((function e(){var t,n,r=arguments;return Object(m["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},n={planId:1*this.options.roomMessage.roomInfo.stuLiveInfo.planId,interactId:this.options.ircMsg.interactId,gameImages:Object(b["a"])(t.gameImages),userAnswerResult:Object(b["a"])(t.userAnswerResult)},e.next=4,Object(w["d"])(n);case 4:case"end":return e.stop()}}),e,this)})));function t(){return console.info("函数申明 submitPics, filePath:renderer/components/Classroom/CommonInteractions/gameCourseware/game.js"),e.apply(this,arguments)}return t}()},{key:"submitAnswer",value:function(){var e=Object(d["a"])(Object(m["a"])().mark((function e(t,n){var r,s;return Object(m["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r={planId:1*this.options.roomMessage.roomInfo.stuLiveInfo.planId,classId:this.options.roomMessage.roomInfo.stuLiveInfo.classId,interactId:this.options.ircMsg.interactId,rightRate:t,isAnswer:n},e.next=3,Object(w["c"])(r);case 3:return s=e.sent,e.abrupt("return",{params:r,response:s});case 5:case"end":return e.stop()}}),e,this)})));function t(t,n){return console.info("函数申明 submitAnswer(_x, _x2)",t,n,"filePath:renderer/components/Classroom/CommonInteractions/gameCourseware/game.js"),e.apply(this,arguments)}return t}()},{key:"interactReport",value:function(e){var t={classId:1*this.options.roomMessage.roomInfo.stuLiveInfo.classId,planId:1*this.options.roomMessage.roomInfo.stuLiveInfo.planId,interactId:this.options.ircMsg.interactId};Object(w["b"])(e,t)}},{key:"getGameStatus",value:function(){var e=Object(d["a"])(Object(m["a"])().mark((function e(){var t;return Object(m["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={classId:1*this.options.roomMessage.roomInfo.stuLiveInfo.classId,planId:1*this.options.roomMessage.roomInfo.stuLiveInfo.planId,interactId:this.options.ircMsg.interactId},e.next=3,Object(w["a"])(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));function t(){return console.info("函数申明 getGameStatus, filePath:renderer/components/Classroom/CommonInteractions/gameCourseware/game.js"),e.apply(this,arguments)}return t}()}]),n}(v["a"]),j=n("d0db"),I=n("1a37"),y=n("e417"),x=n("c02a"),k={name:"GameCourseware",props:{options:{type:Object,default:function(){return{}}}},data:function(){return{gameUrl:null,nickName:"",role:"student",lang:"en",showGame:!1,isAnswer:2,userCoin:null,interactStatus:2,showResultToast:!1,rightCoin:0,isSubmiting:!1}},created:function(){var e=this;return Object(d["a"])(Object(m["a"])().mark((function t(){var n,s,a,o;return Object(m["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.game=new O(Object(r["a"])({},e.options)),e.game.interactReport("open"),t.next=4,e.game.getGameStatus().catch((function(t){return e.sendLogger({msg:"接口报错:开启游戏:",response:t},"error"),t}));case 4:if(n=t.sent,s=n.code,a=n.data,0===s&&1*a.studentInteractStatus!==2&&!a.isSubmit){t.next=9;break}return t.abrupt("return");case 9:return e.changefullPageStyle(!0),t.next=12,e.getGameServe();case 12:o=t.sent,e.interactStatus=1*a.studentInteractStatus,e.nickName=e.options.roomMessage.roomInfo.stuInfo.nickName,e.gameUrl="".concat(o,"/").concat(e.options.ircMsg.interactiveTemplatePath),console.log("加载互动游戏地址 gameUrl",e.gameUrl),e.sendLogger({msg:"收到互动, 加载互动游戏地址: ".concat(JSON.stringify(e.gameUrl)),stage:"start"}),e.showGame=!0,window.thinkApi.ipc.send("test:url",e.gameUrl);case 20:case"end":return t.stop()}}),t)})))()},methods:{getGameServe:function(){var e=this;return Object(d["a"])(Object(m["a"])().mark((function t(){var n,r,s,a,o,i,c,u,l;return Object(m["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n={},r=Object(f["q"])("planId"),t.next=4,p["nativeApi"].getClientInfo();case 4:return s=t.sent,a=s.CW_SERVER_ADDRESS,o=s.CW_WEBROOT,t.next=9,Object(h["b"])(1*r);case 9:if(i=t.sent,0===i.code&&0!==i.data.list.length){t.next=13;break}return e.$Message.info("COURSESWARE ERROR"),t.abrupt("return");case 13:return i.data.list.forEach((function(e){16==e.id&&(n=e)})),c="".concat(a).concat(n.detail.catalog),e.sendLogger({msg:"游戏本地服务域名: ".concat(JSON.stringify(a)).concat(JSON.stringify(n.detail.catalog))}),t.prev=16,t.next=19,Object(g["a"])(n.detail.baseZipUrl,n.detail.baseZipMd5,o);case 19:u=t.sent,u||(l=n.detail.compressIndexUrl.split(n.detail.catalog),c="".concat(l[0]).concat(n.detail.catalog),e.sendLogger({msg:"使用游戏远端服务域名: ".concat(JSON.stringify(l[0])).concat(JSON.stringify(n.detail.catalog))})),t.next=26;break;case 23:t.prev=23,t.t0=t["catch"](16),e.sendLogger({msg:"游戏检查压缩包失败,可能会导致游戏黑屏",stage:"error",params:{error:t.t0}},"error");case 26:return t.abrupt("return",c);case 27:case"end":return t.stop()}}),t,null,[[16,23]])})))()},submitAnswer:function(e){var t=this;return Object(d["a"])(Object(m["a"])().mark((function n(){var s,a,o,i,c,u,l,p,h,g,b,v,w,O;return Object(m["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!t.isSubmiting){n.next=2;break}return n.abrupt("return");case 2:return t.isSubmiting=!0,s=[],a=[],o=e.answerPics,i=e.judge,c=e.rightRate,t.isAnswer=1,n.next=9,t.game.submitAnswer(c,t.isAnswer).catch((function(e){return t.sendLogger({msg:"接口报错:提交游戏数据:",response:e},"error"),e}));case 9:u=n.sent,l=u.params,p=u.response,t.sendLogger({msg:"提交答案结果",params:l,response:p}),h=p.code,g=p.data,0==h&&g&&(t.rightCoin=g.rightCoin,v=100==c?1:2==t.isAnswer?3:2,w=Object(r["a"])(Object(r["a"])({},g),{},{isRight:v,isGameQuestion:!0}),t.$bus.$emit("continuousCorrect",w),t.$bus.$emit("updateAchievement","add",t.rightCoin),x["f"](null===(b=t.options)||void 0===b?void 0:b.ircMsg,"5",v,!0)),o.forEach((function(e,n){a.push(Object(f["e"])(e)),s.push("".concat(t.options.ircMsg.interactId,"_").concat(t.options.roomMessage.roomInfo.stuInfo.id,"_").concat(n,".jpg"))})),O=new I["b"]({scene:"game"});try{O.putFiles({filePaths:s,files:a,success:function(){var e=Object(d["a"])(Object(m["a"])().mark((function e(n){return Object(m["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.game.submitPics({gameImages:n.filePaths,userAnswerResult:i});case 2:t.isSubmiting=!1;case 3:case"end":return e.stop()}}),e)})));function n(t){return e.apply(this,arguments)}return n}(),fail:function(){t.sendLogger({msg:"上传游戏截图失败"})}})}catch(j){console.error("catch上传游戏截图失败",j)}case 18:case"end":return n.stop()}}),n)})))()},gameLoaded:function(){this.sendLogger({msg:"游戏加载成功"})},gameReload:function(){this.sendLogger({msg:"重新加载游戏"})},gameFail:function(){this.sendLogger({msg:"游戏加载失败"})},destroy:function(){var e;Object(y["e"])("hw_classroom_interact_game_quit",this.options.roomMessage.roomInfo.commonOption,{interact_id:this.options.ircMsg.interactId}),this.$destroy(),null===(e=this.$el)||void 0===e||null===(e=e.parentNode)||void 0===e||e.removeChild(this.$el)},changefullPageStyle:function(e){var t=document.getElementById("interactionGame"),n=document.getElementsByClassName("courseware-area-wrapper-top")[0],r=this.options.roomMessage.roomInfo.commonOption.classType;e?(2==r?(t.style.zIndex=2001,n.style.zIndex=2300):t.style.zIndex=1003,t.style.height="100%",t.style.backgroundColor="#000000"):(t.style.zIndex=1,2==r&&(n.style.zIndex=1003),t.style.height="auto",t.style.backgroundColor="transparent")},sendLogger:function(e){var t=e.msg,n=void 0===t?"":t,r=e.stage,s=void 0===r?"":r,a=e.params,o=void 0===a?{}:a,i=e.response,c=void 0===i?{}:i,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";j["a"].send({tag:"student.Interact",content:{msg:n,interactType:"Game",interactId:this.options.ircMsg.interactId,interactStage:s,params:JSON.stringify(o),response:JSON.stringify(c)},level:u})}},destroyed:function(){if(2===this.isAnswer&&2!==this.interactStatus){var e={isRight:3,isGameQuestion:!0,rightCoin:0};this.$bus.$emit("continuousCorrect",e),this.game.submitAnswer(0,2)}else this.$bus.$emit("continuousCorrect",!1);this.game.interactReport("close"),this.sendLogger({msg:"结束互动",stage:"end"}),this.showGame=!1,this.changefullPageStyle(!1)}},C=k,S=n("2877"),M=Object(S["a"])(C,u,l,!1,null,null,null),A=M.exports,R=function(e){Object(o["a"])(n,e);var t=Object(i["a"])(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return console.info("函数申明 GameCourseware(opts)",r,"filePath:renderer/components/Classroom/CommonInteractions/gameCourseware/index.js"),Object(s["a"])(this,n),e=t.call(this,A),e.options=r,e.dom=r.roomMessage.roomInfo.interactionGame,e.initVmApp("游戏课件"),e}return Object(a["a"])(n,[{key:"createPropsData",value:function(){var e={};return Object(r["a"])({options:this.options},e)}}]),n}(c["a"])},b6c9:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n("d4ec"),s=n("bee2"),a=(n("99af"),n("d9e2"),n("8bbf")),o=n.n(a),i=n("3898"),c=n("d0db"),u=function(){function e(t){console.info("函数申明 InteractionBase(app)",t,"filePath:renderer/components/Classroom/CommonInteractions/interaction-base.js"),Object(r["a"])(this,e),this.app=t,this.vm=null,this.keepOtherDom=!1}return Object(s["a"])(e,[{key:"initVmApp",value:function(e){if(!this.dom)throw Error("互动的dom容器不存在");this.dom.children.length>0&&!this.keepOtherDom&&(c["a"].send({tag:"tempInteractionTest",content:{msg:"清空互动容器，由".concat(e,"触发清空，清空").concat(this.dom.children[0].className)}}),this.dom.innerHTML=""),this.vm=this.initVm(this.app),this.render(this.dom,this.vm)}},{key:"initVm",value:function(e){var t=o.a.extend(e),n=this.createPropsData(),r=new t({i18n:i["b"],propsData:n,store:this.store||{}});return r.$mount(),r}},{key:"render",value:function(e,t){e.appendChild(t.$el)}},{key:"destroy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.submit,n=e.key,r=void 0===n?"":n;if(this.vm){var s,a;if(t&&this.vm.submit(),this.vm.$destroy(),"classRest"===r)null===this||void 0===this||null===(s=this.dom)||void 0===s||s.removeChild(null===this||void 0===this||null===(a=this.vm)||void 0===a?void 0:a.$el);else this.dom.innerHTML="";this.vm=null,this.app=null}}},{key:"getProperties",value:function(e,t){return e["".concat(t)].properties}},{key:"handleMsg",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};console.log(e)}}]),e}()}}]);
//# sourceMappingURL=chunk-06ac8425.2285f634.js.map