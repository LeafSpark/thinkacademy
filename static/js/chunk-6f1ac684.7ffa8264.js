(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6f1ac684"],{"217d":function(t,e,i){"use strict";var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"audio-waves",class:[t.skinClass,t.size]},[t.animation?e("div",{staticClass:"waves-wrapper"},[e("span",{staticClass:"waves-item waves-animation waves1",class:t.animationTypeClass}),e("span",{staticClass:"waves-item waves-animation waves2",class:t.animationTypeClass}),e("span",{staticClass:"waves-item waves-animation waves3",class:t.animationTypeClass}),e("span",{staticClass:"waves-item waves-animation waves4",class:t.animationTypeClass}),"large"===t.size?e("span",{staticClass:"waves-item waves-animation waves5",class:t.animationTypeClass}):t._e(),"large"===t.size?e("span",{staticClass:"waves-item waves-animation waves6",class:t.animationTypeClass}):t._e()]):e("div",{staticClass:"waves-wrapper"},[e("span",{staticClass:"waves-item default-bg waves1"}),e("span",{staticClass:"waves-item default-bg waves2"}),e("span",{staticClass:"waves-item default-bg waves3"}),e("span",{staticClass:"waves-item default-bg waves4"}),"large"===t.size?e("span",{staticClass:"waves-item default-bg waves5"}):t._e(),"large"===t.size?e("span",{staticClass:"waves-item default-bg waves6"}):t._e()])])},n=[],a={props:{animation:{default:!1,type:Boolean},animationType:{default:"liner",type:String},size:{default:"large",type:String},skin:{default:"orange",type:String}},computed:{skinClass:function(){return console.info("对象函数 skinClass,filePath:renderer/components/Common/AudioWaves.vue"),"skin-".concat(this.skin)},animationTypeClass:function(){return console.info("对象函数 animationTypeClass,filePath:renderer/components/Common/AudioWaves.vue"),"animation-".concat(this.animationType)}}},o=a,c=(i("29df"),i("2877")),r=Object(c["a"])(o,s,n,!1,null,"1051bd64",null);e["a"]=r.exports},"29df":function(t,e,i){"use strict";i("5ddf")},"5ddf":function(t,e,i){},"65f7":function(t,e,i){"use strict";i("e778")},b6c9:function(t,e,i){"use strict";i.d(e,"a",(function(){return d}));var s=i("d4ec"),n=i("bee2"),a=(i("99af"),i("d9e2"),i("8bbf")),o=i.n(a),c=i("3898"),r=i("d0db"),d=function(){function t(e){console.info("函数申明 InteractionBase(app)",e,"filePath:renderer/components/Classroom/CommonInteractions/interaction-base.js"),Object(s["a"])(this,t),this.app=e,this.vm=null,this.keepOtherDom=!1}return Object(n["a"])(t,[{key:"initVmApp",value:function(t){if(!this.dom)throw Error("互动的dom容器不存在");this.dom.children.length>0&&!this.keepOtherDom&&(r["a"].send({tag:"tempInteractionTest",content:{msg:"清空互动容器，由".concat(t,"触发清空，清空").concat(this.dom.children[0].className)}}),this.dom.innerHTML=""),this.vm=this.initVm(this.app),this.render(this.dom,this.vm)}},{key:"initVm",value:function(t){var e=o.a.extend(t),i=this.createPropsData(),s=new e({i18n:c["b"],propsData:i,store:this.store||{}});return s.$mount(),s}},{key:"render",value:function(t,e){t.appendChild(e.$el)}},{key:"destroy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.submit,i=t.key,s=void 0===i?"":i;if(this.vm){var n,a;if(e&&this.vm.submit(),this.vm.$destroy(),"classRest"===s)null===this||void 0===this||null===(n=this.dom)||void 0===n||n.removeChild(null===this||void 0===this||null===(a=this.vm)||void 0===a?void 0:a.$el);else this.dom.innerHTML="";this.vm=null,this.app=null}}},{key:"getProperties",value:function(t,e){return t["".concat(e)].properties}},{key:"handleMsg",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};console.log(t)}}]),t}()},e29a:function(t,e,i){"use strict";i.r(e),i.d(e,"default",(function(){return O}));var s=i("5530"),n=i("d4ec"),a=i("bee2"),o=i("262e"),c=i("2caf"),r=i("b6c9"),d=function(){var t=this,e=t._self._c;return e("div",{class:{hide:t.hideVideoLink}},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.showMinimize,expression:"showMinimize"}],staticClass:"video-link-container video-minimize"},[e("div",{staticClass:"minimize-contenter"},[e("div",{staticClass:"icon-maximize",on:{click:function(e){return t.handleMinimize(!1)}}}),t.studentName?e("div",{staticClass:"student-name",class:[{"remote-student":3==t.status}]},[t._v(" "+t._s(t.studentName)+" ")]):t._e(),e("div",{staticClass:"audio-waves-wrapper"},[e("AudioWaves",{attrs:{animation:t.isShowAudioIcon}})],1)])]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.showMaximize,expression:"showMaximize"}],staticClass:"video-link-container video-maximize"},[e("div",{directives:[{name:"show",rawName:"v-show",value:0==t.status,expression:"status == 0"}],staticClass:"status-join"},[e("div",{staticClass:"video-wrapper"},[e("div",{staticClass:"message-wrapper"},[e("div",{staticClass:"message"},[t._v(" "+t._s(t.$t("classroom.interactions.videoLink.joinMessage"))+" ")])])]),e("div",{staticClass:"btn-wrapper"},[e("div",{staticClass:"btn-join",on:{click:t.handleJoin}},[t._v(" "+t._s(t.$t("classroom.interactions.videoLink.joinButtonName"))+" ")])])]),e("div",{directives:[{name:"show",rawName:"v-show",value:1==t.status,expression:"status == 1"}],staticClass:"status-wait"},[e("div",{staticClass:"video-wrapper"},[e("div",{staticClass:"message-wrapper"},[e("div",{staticClass:"message"},[t._v(" "+t._s(t.$t("classroom.interactions.videoLink.waitMessage"))+" ")])])]),e("div",{staticClass:"btn-wrapper"},[e("div",{staticClass:"btn-cancel-join",on:{click:t.handleCancelJoin}},[t._v(" "+t._s(t.$t("classroom.interactions.videoLink.cancelButton"))+" ")])])]),e("div",{directives:[{name:"show",rawName:"v-show",value:2==t.status||3==t.status,expression:"status == 2 || status == 3"}],staticClass:"status-connect"},[e("div",{staticClass:"icon-minimize",on:{click:function(e){return t.handleMinimize(!0)}}}),e("div",{directives:[{name:"show",rawName:"v-show",value:2==t.status,expression:"status == 2"}],staticClass:"video-wrapper"},[e("div",{staticClass:"video-contenter",attrs:{id:"localVideoContenter"}})]),e("div",{directives:[{name:"show",rawName:"v-show",value:3==t.status,expression:"status == 3"}],staticClass:"video-wrapper"},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.remoteVideoStatus,expression:"remoteVideoStatus"}],staticClass:"video-contenter",attrs:{id:"remoteVideoContenter"}})]),e("div",{staticClass:"video-info"},[e("div",{staticClass:"info-head"},[e("div",{staticClass:"student-name",class:[{"remote-student":3==t.status}]},[t._v(" "+t._s(t.studentName)+" ")]),e("div",{staticClass:"audio-waves-wrapper"},[e("AudioWaves",{attrs:{animation:t.isShowAudioIcon}})],1)]),e("div",{staticClass:"info-button"},[2==t.status?e("div",[e("div",{staticClass:"btn-cancel-join"},[t._v(" "+t._s(t.$t("classroom.interactions.videoLink.speaking"))+" ")])]):t._e(),t.isTargeted||3!=t.status?t._e():e("div",[t.isRaiseHand?e("div",{staticClass:"btn-cancel-join",on:{click:t.handleCancelJoin}},[t._v(" "+t._s(t.$t("common.cancel"))+" ")]):e("div",{staticClass:"btn-join",on:{click:t.handleJoin}},[t._v(" "+t._s(t.$t("classroom.interactions.videoLink.raiseHandButton"))+" ")])])])])])]),e("MediaSecurityAccess",{ref:"MediaSecurityAccess",attrs:{visible:!1}})],1)},l=[],u=i("c7eb"),h=i("1da1"),m=(i("b0c0"),i("d81d"),i("caad"),i("2532"),i("a9e3"),i("bcaf")),v=i("099c"),p=(i("d3b7"),i("159b"),function(t,e){console.info("箭头函数 hasCurrentStudent(stuId, stuList)",t,e,"filePath:renderer/components/Classroom/CommonInteractions/videoLink/utils.js");var i=!1;return e.forEach((function(e){e.id==t&&(i=!0)})),i}),f=i("d0db"),g=i("3b29"),C=i("217d"),w=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};console.info("函数申明 _default(opts)",e,"filePath:renderer/components/Classroom/CommonInteractions/videoLink/rtcClass.js"),Object(n["a"])(this,t),this.options=e.options,this.rtcEngine=window.RTC_COMMON.rtcEngine,this.teacherRtcChannel=window.RTC_COMMON.teacherRtcChannel}return Object(a["a"])(t,[{key:"localVideoStart",value:function(t){if(this.teacherRtcChannel.setClientRole(1),this.teacherRtcChannel.muteLocalAudioStream(!1),t){this.teacherRtcChannel.muteLocalVideoStream(!1);var e=document.getElementById("localVideoContenter");e.innerHTML="",this.rtcEngine.setupLocalVideo(e)}else this.teacherRtcChannel.muteLocalVideoStream(!0)}},{key:"unpublish",value:function(){this.teacherRtcChannel.setClientRole(0),this.teacherRtcChannel.muteLocalAudioStream(!0),this.teacherRtcChannel.muteLocalVideoStream(!0)}},{key:"setupRemoteVideo",value:function(t){var e=document.getElementById("remoteVideoContenter");e.innerHTML="",this.teacherRtcChannel.setupRemoteVideo(Number(t),e)}}]),t}(),b=i("e417"),M=i("c02a"),S=null,k=null,V={components:{MediaSecurityAccess:g["a"],AudioWaves:C["a"]},props:{options:{type:Object,default:function(){return{ircMsg:{},roomMessage:{roomInfo:{commonOption:{},planInfo:{},stuInfo:{}}}}}}},data:function(){return{ircMsg:this.options.ircMsg,isTargeted:!1,status:0,isRaiseHand:!1,planName:this.options.roomMessage.roomInfo.planInfo.name,studentName:"",isShowAudioIcon:!1,cameraStatus:!0,cameraSettingStatus:!1,microphoneStatus:!1,localDisplayVideoStatus:!0,remoteVideoStatus:!1,isMinimize:!1,highEncoderConfig:{width:320,height:240,bitrate:120,frameRate:10},lowEncoderConfig:{bitrate:80,frameRate:10,width:160,height:120}}},computed:{hideVideoLink:function(){return this.isTargeted&&(0==this.status||1==this.status)},showMinimize:function(){return this.isMinimize&&(2==this.status||3==this.status)},showMaximize:function(){return!this.isMinimize||this.isMinimize&&(0==this.status||1==this.status)}},mounted:function(){var t=this;console.log("videoLink-options",this.options),this.$bus.$emit("getLocalDisplayVideoStatus",(function(e){t.localDisplayVideoStatus=e})),this.$bus.$on("updateLocalDisplayVideoStatus",(function(e){t.localDisplayVideoStatus=e})),this.$refs["MediaSecurityAccess"].checkAccess(),this.rtcClass=new w(this.options),this.initMinimize(),this.initRtcEvent(),this.videoLinkMessage(this.options.ircMsg)},beforeDestroy:function(){var t;null===(t=window.RTC_COMMON)||void 0===t||null===(t=t.classRtcChannel)||void 0===t||t.setVideoEncoderConfiguration(this.lowEncoderConfig),this.rtcClass.teacherRtcChannel.off("remoteVideoStateChanged",this.listenRemoteVideoStateChanged),this.rtcClass.rtcEngine.off("groupAudioVolumeIndication",this.listenGroupAudioVolumeIndication),this.$bus.$off("updateLocalDisplayVideoStatus")},methods:{initMinimize:function(){console.log("videoLink-initMinimize",k),null!==k&&(this.isMinimize=k)},initRtcEvent:function(){this.rtcClass.teacherRtcChannel.on("remoteVideoStateChanged",this.listenRemoteVideoStateChanged),this.rtcClass.rtcEngine.on("groupAudioVolumeIndication",this.listenGroupAudioVolumeIndication)},listenRemoteVideoStateChanged:function(t,e,i){console.log("videoLink-remoteVideoStateChanged",t,e,i);var s=this.options.roomMessage.roomInfo.configs.rtcConfig.teacherVideoUid;if(t!=s){var n=this.getRemoteStuInfo();2===e&&n.id==t?(this.rtcClass.setupRemoteVideo(t),this.remoteVideoStatus=!0):this.remoteVideoStatus=!1}},listenGroupAudioVolumeIndication:function(t){console.log("videoLink-groupAudioVolumeIndication",t),this.handleAudioIcon(t)},handleJoin:function(t){var e=this;return Object(h["a"])(Object(u["a"])().mark((function i(){var s,n,a,o,c,r;return Object(u["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return s=t.autoJoin,n=void 0!==s&&s,i.next=3,e.getMediaStatus();case 3:if(n||e.microphoneStatus){i.next=7;break}return e.$refs["MediaSecurityAccess"].checkAccess(),e.sendLogger("举手失败, 失败原因: 未开启麦克风权限"),i.abrupt("return");case 7:if(n||Object(b["e"])("hw_classroom_interact_video_chat_control",e.options.roomMessage.roomInfo.commonOption,{interact_id:e.options.ircMsg.interactId,control_type:"举手"}),a=e.options.roomMessage.roomInfo.stuInfo||{},o=e.options.ircMsg,c=JSON.stringify({type:125,status:6,id:a.id,name:a.nickName,image:a.avatar,classId:e.options.roomMessage.roomInfo.stuLiveInfo.classId,cameraAvailable:e.cameraStatus?1:0,cameraIsOpen:e.cameraStatus&&e.localDisplayVideoStatus?1:2,mikeAvailable:e.microphoneStatus?1:0}),console.log("videoLink-handleJoinMessage-sendPeerMessage",c),r=window.ChatClient.PeerChatManager.sendPeerMessage([{nickname:o.from}],c,m["a"].notice),console.log("videoLink-handleJoinMessage-res",r),0==r){i.next=17;break}return e.sendLogger("举手消息发送失败: irc消息响应结果: ".concat(r)),i.abrupt("return");case 17:0==e.status&&(e.status=1),e.isRaiseHand=!0,e.sendLogger("举手消息发送成功");case 20:case"end":return i.stop()}}),i)})))()},handleCancelJoin:function(){Object(b["e"])("hw_classroom_interact_video_chat_control",this.options.roomMessage.roomInfo.commonOption,{interact_id:this.options.ircMsg.interactId,control_type:"取消举手"});var t=this.options.roomMessage.roomInfo.stuInfo||{},e=this.options.ircMsg,i=JSON.stringify({type:125,status:7,id:t.id}),s=window.ChatClient.PeerChatManager.sendPeerMessage([{nickname:e.from}],i,m["a"].notice);console.log("videoLink-handleCancelJoinMessage",s),0==s?(1==this.status&&(this.status=0),this.isRaiseHand=!1,this.sendLogger("取消举手消息发送成功")):this.sendLogger("取消举手消息发送失败: irc消息响应结果: ".concat(s))},videoLinkMessage:function(t){console.log("videoLink-videoLinkMessage",t),this.sendLogger("收到视频连麦互动消息: ".concat(JSON.stringify(t))),this.ircMsg=t;var e=this.options.roomMessage.roomInfo.stuInfo||{},i=t.status,s=t.targeted;if(s&&(this.isTargeted=!0,this.handleJoin({autoJoin:!0})),1===i&&this.$bus.$emit("videoLinkStatus",!0),2===i&&(this.$bus.$emit("videoLinkStatus",!1),this.sendLogger("结束视频连麦互动: ".concat(JSON.stringify(t)),"end"),this.localVideoEnd(),this.destroy()),4===i){var n,a;if(this.sendLogger("开始视频连麦互动: ".concat(JSON.stringify(t)),"start"),p(e.id,t.data))return null===(n=window.RTC_COMMON)||void 0===n||null===(n=n.classRtcChannel)||void 0===n||n.setVideoEncoderConfiguration(this.highEncoderConfig),void this.localVideoStart(t);null===(a=window.RTC_COMMON)||void 0===a||null===(a=a.classRtcChannel)||void 0===a||a.setVideoEncoderConfiguration(this.lowEncoderConfig),this.remoteVideoStart(t)}},localVideoStart:function(t){var e=this;return Object(h["a"])(Object(u["a"])().mark((function i(){var s;return Object(u["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return console.log("videoLink-localVideoStart",t),e.$bus.$emit("localVideoLinkStatus",!0),i.next=4,e.getMediaStatus();case 4:e.status=2,e.isRaiseHand=!1,e.studentName=e.$t("common.me"),e.$nextTick((function(){var t=e.localDisplayVideoStatus&&e.cameraStatus;e.showLinkVideoEvent(t),e.rtcClass.localVideoStart(t)})),M["o"](null===(s=e.ircMsg)||void 0===s?void 0:s.interactId,"",!0);case 9:case"end":return i.stop()}}),i)})))()},localVideoEnd:function(){var t;this.rtcClass.unpublish(),this.$bus.$emit("localVideoLinkStatus",!1),console.log("videoLink-localVideoEnd"),M["o"](null===(t=this.ircMsg)||void 0===t?void 0:t.interactId,"",!1)},remoteVideoStart:function(t){var e=this;console.log("videoLink-remoteVideoStart",t),2==this.status&&this.localVideoEnd();var i=this.getRemoteStuInfo();i.id&&(this.studentName=i.name,this.status=3,this.remoteVideoStatus=1==i.cameraIsOpen,this.$nextTick((function(){e.showLinkVideoEvent(e.remoteVideoStatus),e.rtcClass.setupRemoteVideo(i.id)})))},showLinkVideoEvent:function(t){Object(b["e"])("hw_classroom_interact_video_chat",this.options.roomMessage.roomInfo.commonOption,{interact_id:this.options.ircMsg.interactId,video_chat_type:this.isTargeted?2:1,video_state:t?1:0,voice_state:this.microphoneStatus?1:0})},handleAudioIcon:function(t){var e=t.map((function(t){return t.uid})),i=this.getRemoteStuInfo(),s=i.id,n=t.map((function(t){return 0===t.uid?t.volume:0}))[0];s&&e.includes(Number(s))&&this.showRemoteAudioIcon(),this.showLocalAudioIcon(n)},showRemoteAudioIcon:function(){var t=this;3==this.status&&(this.isShowAudioIcon=!0,clearTimeout(S),S=setTimeout((function(){t.isShowAudioIcon=!1}),500))},showLocalAudioIcon:function(t){2==this.status&&(0!=t?this.isShowAudioIcon||(this.isShowAudioIcon=!0):this.isShowAudioIcon&&(this.isShowAudioIcon=!1))},getRemoteStuInfo:function(){return this.ircMsg.data.length?this.ircMsg.data[0]:{}},getMediaStatus:function(){var t=this;return Object(h["a"])(Object(u["a"])().mark((function e(){return Object(u["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(v["c"])();case 2:return t.cameraStatus=e.sent,e.next=5,Object(v["f"])();case 5:t.microphoneStatus=e.sent;case 6:case"end":return e.stop()}}),e)})))()},handleMinimize:function(t){this.isMinimize=t,k=t},sendLogger:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";f["a"].send({tag:"student.Interact",content:{msg:t,interactType:"LinkMic",interactId:this.options.ircMsg.interactId,interactStage:e}})},destroy:function(){var t;this.$destroy(),null===(t=this.$el)||void 0===t||null===(t=t.parentNode)||void 0===t||t.removeChild(this.$el)}}},I=V,L=(i("65f7"),i("2877")),y=Object(L["a"])(I,d,l,!1,null,"2997b28c",null),_=y.exports,O=function(t){Object(o["a"])(i,t);var e=Object(c["a"])(i);function i(){var t,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return console.info("函数申明 VideoLink(opts)",s,"filePath:renderer/components/Classroom/CommonInteractions/videoLink/index.js"),Object(n["a"])(this,i),t=e.call(this,_),t.options=s,t.dom=s.roomMessage.roomInfo.interactionController,t.initVmApp("视频连麦"),t}return Object(a["a"])(i,[{key:"createPropsData",value:function(){var t={};return Object(s["a"])({options:this.options},t)}}]),i}(r["a"])},e778:function(t,e,i){}}]);
//# sourceMappingURL=chunk-6f1ac684.7ffa8264.js.map